<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>
      <%= title.titre %> - RadioMel
   </title>
</head>

<style>
   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

   * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
   }

   body {
      min-height: 100vh;
      background: #0a0a0a;
      font-family: 'Inter', sans-serif;
      color: #fff;
      position: relative;
      overflow-x: hidden;
      padding: 40px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
   }

   /* Canvas pour les particules */
   #particleCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
   }

   /* Container principal */
   .track-container {
      max-width: 700px;
      width: 100%;
      background: #12121255;
      backdrop-filter: blur(10px);
      border-radius: 32px;
      padding: 48px;
      position: relative;
      z-index: 1;
      border: 1px solid #2a2a2a;
   }

   /* Back button */
   .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: transparent;
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      color: #666;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      margin-bottom: 32px;
      text-decoration: none;
   }

   .back-btn:hover {
      border-color: #fff;
      color: #fff;
      transform: translateX(-4px);
   }

   .back-icon {
      width: 16px;
      height: 16px;
   }

   /* Track ID Badge */
   .track-id-badge {
      display: inline-block;
      padding: 6px 16px;
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 20px;
      color: #666;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 32px;
   }

   .track-id-badge span {
      color: #fff;
      margin-left: 4px;
   }

   /* Cover Section */
   .cover-section {
      display: flex;
      align-items: flex-start;
      gap: 32px;
      margin-bottom: 48px;
   }

   .cover-image {
      width: 200px;
      height: 200px;
      border-radius: 20px;
      object-fit: cover;
      border: 2px solid #2a2a2a;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      flex-shrink: 0;
   }

   .track-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
   }

   .track-title {
      font-size: 32px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 12px;
      letter-spacing: -0.5px;
      line-height: 1.2;
   }

   .track-artist {
      font-size: 20px;
      font-weight: 400;
      color: #666;
      margin-bottom: 16px;
   }

   .track-year {
      display: inline-block;
      padding: 8px 16px;
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      color: #666;
      font-size: 14px;
      font-weight: 600;
   }

   .track-year span {
      color: #fff;
      margin-left: 4px;
   }

   /* Audio Player */
   .audio-player-section {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 32px;
   }

   .audio-player-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
   }

   .audio-player-icon {
      width: 24px;
      height: 24px;
      color: #666;
   }

   .audio-player-title {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 0.5px;
   }

   /* Custom Audio Player */
   .custom-audio-player {
      display: flex;
      flex-direction: column;
      gap: 20px;
   }

   .player-controls {
      display: flex;
      align-items: center;
      gap: 16px;
   }

   .play-btn {
      width: 56px;
      height: 56px;
      background: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      flex-shrink: 0;
   }

   .play-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 24px rgba(255, 255, 255, 0.3);
   }

   .play-btn:active {
      transform: scale(0.95);
   }

   .play-btn svg {
      width: 24px;
      height: 24px;
      color: #0a0a0a;
   }

   .play-btn.playing svg {
      width: 20px;
      height: 20px;
   }

   .time-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
   }

   .time-current,
   .time-duration {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      min-width: 45px;
   }

   .time-current {
      color: #fff;
   }

   .progress-bar {
      flex: 1;
      height: 6px;
      background: #0a0a0a;
      border-radius: 3px;
      position: relative;
      cursor: pointer;
   }

   .progress-fill {
      height: 100%;
      background: #fff;
      border-radius: 3px;
      width: 0%;
      transition: width 0.1s linear;
      position: relative;
   }

   .progress-fill::after {
      content: '';
      position: absolute;
      right: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.5);
   }

   .volume-control {
      display: flex;
      align-items: center;
      gap: 12px;
   }

   .volume-btn {
      width: 40px;
      height: 40px;
      background: transparent;
      border: 1px solid #2a2a2a;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
   }

   .volume-btn:hover {
      border-color: #fff;
      background: #2a2a2a;
   }

   .volume-btn svg {
      width: 18px;
      height: 18px;
      color: #666;
   }

   .volume-btn:hover svg {
      color: #fff;
   }

   .volume-slider {
      width: 80px;
      height: 4px;
      background: #0a0a0a;
      border-radius: 2px;
      position: relative;
      cursor: pointer;
   }

   .volume-fill {
      height: 100%;
      background: #666;
      border-radius: 2px;
      width: 100%;
      transition: width 0.1s ease;
   }

   /* Track Details */
   .track-details {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 32px;
   }

   .details-title {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
   }

   .details-title svg {
      width: 20px;
      height: 20px;
      color: #666;
   }

   .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #2a2a2a;
   }

   .detail-row:last-child {
      border-bottom: none;
   }

   .detail-label {
      font-size: 14px;
      color: #666;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
   }

   .detail-value {
      font-size: 14px;
      color: #fff;
      font-weight: 600;
      text-align: right;
   }

   /* Action Buttons */
   .action-buttons {
      display: flex;
      gap: 12px;
   }

   .action-btn {
      flex: 1;
      padding: 18px;
      border: none;
      border-radius: 16px;
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
   }

   .action-btn-edit {
      background: #fff;
      color: #0a0a0a;
   }

   .action-btn-edit:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 255, 255, 0.2);
   }

   .action-btn-download {
      background: transparent;
      border: 1px solid #2a2a2a;
      color: #666;
   }

   .action-btn-download:hover {
      border-color: #fff;
      color: #fff;
      background: #2a2a2a;
   }

   .action-btn svg {
      width: 18px;
      height: 18px;
   }

   /* Hidden audio element */
   audio {
      display: none;
   }

   /* Responsive */
   @media (max-width: 768px) {
      .track-container {
         padding: 32px 24px;
      }

      .cover-section {
         flex-direction: column;
         align-items: center;
         text-align: center;
      }

      .cover-image {
         width: 100%;
         max-width: 250px;
         height: auto;
         aspect-ratio: 1;
      }

      .track-title {
         font-size: 24px;
      }

      .track-artist {
         font-size: 18px;
      }

      .audio-player-section,
      .track-details {
         padding: 24px;
      }

      .time-info {
         flex-direction: column;
         align-items: stretch;
         gap: 8px;
      }

      .time-current,
      .time-duration {
         text-align: center;
      }

      .volume-control {
         margin-top: 16px;
         justify-content: center;
      }

      .action-buttons {
         flex-direction: column;
      }
   }

   @media (max-width: 480px) {
      .track-container {
         padding: 24px 16px;
      }

      .track-title {
         font-size: 20px;
      }
   }
</style>

<body>
   <!-- Canvas pour les particules -->
   <canvas id="particleCanvas"></canvas>

   <div class="track-container">
      <!-- Back button -->
      <a href="/admin" class="back-btn">
         <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
         </svg>
         Back to Library
      </a>

      <!-- Track ID Badge -->
      <div class="track-id-badge">TRACK ID:<span>#<%= title.id %></span></div>

      <!-- Cover & Main Info -->
      <div class="cover-section">
         <img src="../Covers/<%= title.cover %>" alt="<%= title.titre %>" class="cover-image">
         <div class="track-info">
            <h1 class="track-title">
               <%= title.titre %>
            </h1>
            <p class="track-artist">
               <%= title.artiste %>
            </p>
            <% if (title.annee && title.annee !=='0000' ) { %>
               <div class="track-year">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                     <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                     <line x1="16" y1="2" x2="16" y2="6"></line>
                     <line x1="8" y1="2" x2="8" y2="6"></line>
                     <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span>
                     <%= title.annee %>
                  </span>
               </div>
               <% } %>
         </div>
      </div>

      <!-- Audio Player -->
      <div class="audio-player-section">
         <div class="audio-player-header">
            <svg class="audio-player-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
               <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <h2 class="audio-player-title">Now Playing</h2>
         </div>

         <div class="custom-audio-player">
            <div class="player-controls">
               <button class="play-btn" id="playBtn">
                  <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor">
                     <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                  <svg id="pauseIcon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                     <rect x="6" y="4" width="4" height="16"></rect>
                     <rect x="14" y="4" width="4" height="16"></rect>
                  </svg>
               </button>

               <div class="time-info">
                  <span class="time-current" id="currentTime">0:00</span>
                  <div class="progress-bar" id="progressBar">
                     <div class="progress-fill" id="progressFill"></div>
                  </div>
                  <span class="time-duration" id="duration">0:00</span>
               </div>
            </div>

            <div class="volume-control">
               <button class="volume-btn" id="volumeBtn">
                  <svg id="volumeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                     <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                     <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                  </svg>
                  <svg id="mutedIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     style="display: none;">
                     <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                     <line x1="23" y1="9" x2="17" y2="15"></line>
                     <line x1="17" y1="9" x2="23" y2="15"></line>
                  </svg>
               </button>
               <div class="volume-slider" id="volumeSlider">
                  <div class="volume-fill" id="volumeFill"></div>
               </div>
            </div>
         </div>

         <!-- <pre> <%= JSON.stringify(title, null, 2) %> </pre> -->

         <!-- Hidden audio element -->
         <audio id="audioPlayer" preload="metadata">
            <source src="../Music/<%= title.url %>" type="audio/mpeg">
            Your browser does not support the audio element.
         </audio>
      </div>

      <!-- Track Details -->
      <div class="track-details">
         <h3 class="details-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
               <circle cx="12" cy="12" r="10"></circle>
               <line x1="12" y1="16" x2="12" y2="12"></line>
               <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            Track Information
         </h3>
         <div class="detail-row">
            <span class="detail-label">Title</span>
            <span class="detail-value">
               <%= title.titre %>
            </span>
         </div>
         <div class="detail-row">
            <span class="detail-label">Artist</span>
            <span class="detail-value">
               <%= title.artiste %>
            </span>
         </div>
         <div class="detail-row">
            <span class="detail-label">Year</span>
            <span class="detail-value">
               <%= title.annee && title.annee !=='0000' ? title.annee : 'Unknown' %>
            </span>
         </div>
         <div class="detail-row">
            <span class="detail-label">Filename</span>
            <span class="detail-value">
               <%= title.url %>
            </span>
         </div>
         <div class="detail-row">
            <span class="detail-label">Cover</span>
            <span class="detail-value">
               <%= title.cover %>
            </span>
         </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
         <a href="/edit-title/<%= title.id %>" class="action-btn action-btn-edit">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
               <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
               <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Edit Track
         </a>
         <a href="../Musiques/<%= title.url %>" download class="action-btn action-btn-download">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
               <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
               <polyline points="7 10 12 15 17 10"></polyline>
               <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Download
         </a>
      </div>
   </div>

   <script>
      // ============================================
      // AUDIO PLAYER CONTROLS
      // ============================================

      const audio = document.getElementById('audioPlayer');
      const playBtn = document.getElementById('playBtn');
      const playIcon = document.getElementById('playIcon');
      const pauseIcon = document.getElementById('pauseIcon');
      const currentTimeEl = document.getElementById('currentTime');
      const durationEl = document.getElementById('duration');
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const volumeBtn = document.getElementById('volumeBtn');
      const volumeIcon = document.getElementById('volumeIcon');
      const mutedIcon = document.getElementById('mutedIcon');
      const volumeSlider = document.getElementById('volumeSlider');
      const volumeFill = document.getElementById('volumeFill');

      // Format time helper
      function formatTime(seconds) {
         const mins = Math.floor(seconds / 60);
         const secs = Math.floor(seconds % 60);
         return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      // Play/Pause toggle
      playBtn.addEventListener('click', () => {
         if (audio.paused) {
            audio.play();
            playBtn.classList.add('playing');
            playIcon.style.display = 'none';
            pauseIcon.style.display = 'block';
         } else {
            audio.pause();
            playBtn.classList.remove('playing');
            playIcon.style.display = 'block';
            pauseIcon.style.display = 'none';
         }
      });

      // Update duration when metadata loads
      audio.addEventListener('loadedmetadata', () => {
         durationEl.textContent = formatTime(audio.duration);
      });

      // Update current time and progress
      audio.addEventListener('timeupdate', () => {
         currentTimeEl.textContent = formatTime(audio.currentTime);
         const progress = (audio.currentTime / audio.duration) * 100;
         progressFill.style.width = progress + '%';
      });

      // Seek functionality
      progressBar.addEventListener('click', (e) => {
         const rect = progressBar.getBoundingClientRect();
         const percent = (e.clientX - rect.left) / rect.width;
         audio.currentTime = percent * audio.duration;
      });

      // Reset when audio ends
      audio.addEventListener('ended', () => {
         playBtn.classList.remove('playing');
         playIcon.style.display = 'block';
         pauseIcon.style.display = 'none';
         progressFill.style.width = '0%';
      });

      // Volume control
      let lastVolume = 1;

      volumeBtn.addEventListener('click', () => {
         if (audio.volume > 0) {
            lastVolume = audio.volume;
            audio.volume = 0;
            volumeFill.style.width = '0%';
            volumeIcon.style.display = 'none';
            mutedIcon.style.display = 'block';
         } else {
            audio.volume = lastVolume;
            volumeFill.style.width = (lastVolume * 100) + '%';
            volumeIcon.style.display = 'block';
            mutedIcon.style.display = 'none';
         }
      });

      volumeSlider.addEventListener('click', (e) => {
         const rect = volumeSlider.getBoundingClientRect();
         const percent = (e.clientX - rect.left) / rect.width;
         audio.volume = percent;
         volumeFill.style.width = (percent * 100) + '%';

         if (percent > 0) {
            volumeIcon.style.display = 'block';
            mutedIcon.style.display = 'none';
         } else {
            volumeIcon.style.display = 'none';
            mutedIcon.style.display = 'block';
         }
      });

      // ============================================
      // SYSTÃˆME DE PARTICULES CANVAS
      // ============================================

      const canvas = document.getElementById('particleCanvas');
      const ctx = canvas.getContext('2d');

      function resizeCanvas() {
         canvas.width = window.innerWidth;
         canvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      class Particle {
         constructor() {
            this.reset();
         }

         reset() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2 + 0.5;
            this.speedX = (Math.random() - 0.5) * 0.5;
            this.speedY = (Math.random() - 0.5) * 0.5;
            this.opacity = Math.random() * 0.5 + 0.2;
            this.color = Math.random() > 0.5 ? '#ffffff' : '#666666';
         }

         update() {
            this.x += this.speedX;
            this.y += this.speedY;

            if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
            if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
         }

         draw() {
            ctx.fillStyle = this.color;
            ctx.globalAlpha = this.opacity;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
         }
      }

      const particles = [];
      var particleCount;

      if (window.innerWidth < 400) {
         particleCount = 50;
      } else if (window.innerWidth < 600) {
         particleCount = 100;
      } else if (window.innerWidth < 900) {
         particleCount = 150;
      } else if (window.innerWidth < 1200) {
         particleCount = 250;
      } else if (window.innerWidth < 1600) {
         particleCount = 350;
      } else if (window.innerWidth < 2000) {
         particleCount = 550;
      } else {
         particleCount = 700;
      }

      for (let i = 0; i < particleCount; i++) {
         particles.push(new Particle());
      }

      function animateParticles() {
         ctx.clearRect(0, 0, canvas.width, canvas.height);

         ctx.globalAlpha = 0.1;
         for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
               const dx = particles[i].x - particles[j].x;
               const dy = particles[i].y - particles[j].y;
               const distance = Math.sqrt(dx * dx + dy * dy);

               if (distance < 120) {
                  ctx.strokeStyle = '#666666';
                  ctx.lineWidth = 0.5;
                  ctx.beginPath();
                  ctx.moveTo(particles[i].x, particles[i].y);
                  ctx.lineTo(particles[j].x, particles[j].y);
                  ctx.stroke();
               }
            }
         }

         particles.forEach(particle => {
            particle.update();
            particle.draw();
         });

         requestAnimationFrame(animateParticles);
      }

      animateParticles();
   </script>
</body>

</html>